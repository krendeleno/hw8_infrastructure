# Домашка по инфраструктуре
Все скрипты находятся в папке sh, работает на гитхаб экшенах, которые запускаются при появлении нового тега, посмотреть результат работы можно по ссылкам в примечании и в логах гитхаб экшенов по тегнутым (и не только, т.к. было неудобно тестировать) коммитам

## newTicket.sh
- Сначала ищется текущий и последний тег, потом формируется автор и дата (текущего тега), гитлог
- Потом собираются всякие поля для json для запроса к трекеру
- Посылается POST запрос к трекеру через curl, берется его статус ответа
- Если все ок, то все ок
- Если 409 код ответа, то посылается PATCH запрос на обновление тикета, после запроса на поиск ID нужного тикета по уникальному идентификатору
- Иначе выводится сообщение о том что все плохо с полученным статус кодом


## tests.sh
- Прогоняется мой потрясающий единственный автотест, все записывается в переменную testResult с выпиливанием символов, которые не принимает json (вообще выглядит довольно криво, но не знаю, как можно было бы записывать красивее, учитывая проблемы с \n)
- Через POST запрос ищется id нужного тикета по версии релиза
- Создается новый коммент с результатами автотестов
- Если все ок, то все ок
- Иначе выводится сообщение о том что все плохо с полученным статус кодом

## docker.sh
Короче у меня винда и я просто скопировала код с лекции, но надеюсь все работает
- Создается докер-образ с нужной версией релиза
- Если все ок, то создается новый коммент с информацией о том, что докер-образ был создан
- Если все ок, то все ок
- Иначе выводится сообщение о том что все плохо с полученным статус кодом

### Примечания
Довольно странно, что \n вырезаются полностью при работе гитхаб экшенов и в итоге записи в тикете выглядят плохо, но при локальном запуске все ок
- Пример локального запуска: https://tracker.yandex.ru/TMP-314
- Пример запуска с гитхаб экшенов: https://tracker.yandex.ru/TMP-328
